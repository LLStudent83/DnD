(()=>{"use strict";class t{static save(t){const e=t.innerHTML;localStorage.setItem("state",e)}static load(t){null!==t&&(document.querySelector(".board").innerHTML=t)}}new class{constructor(t){this.container="string"==typeof t?document.querySelector(t):t,this.draggedEl=null,this.onClick=this.onClick.bind(this),this.showCloseTask=this.showCloseTask.bind(this),this.hideCloseTask=this.hideCloseTask.bind(this),this.onMousedown=this.onMousedown.bind(this),this.onMouseup=this.onMouseup.bind(this),this.onMousemove=this.onMousemove.bind(this),this.init()}init(){null===localStorage.getItem("state")&&t.load(null),t.load(localStorage.getItem("state")),this.addAvents()}addAvents(){this.columns=Array.from(document.querySelectorAll(".taskColumn"));for(const t of this.columns)t.addEventListener("click",(t=>this.onClick(t)));const t=Array.from(this.container.querySelectorAll(".taskColumn__card"));for(const e of t)e.addEventListener("mouseenter",(t=>this.showCloseTask(t))),e.addEventListener("mouseleave",(t=>this.hideCloseTask(t))),e.addEventListener("mousedown",(t=>this.onMousedown(t))),e.addEventListener("mouseup",(t=>this.onMouseup(t)))}onClick(t){t.target.classList.contains("taskColumn__futerAdd")?this.showAddCard(t):t.target.classList.contains("taskColumn__futerClose")?this.closeAddCard(t):t.target.classList.contains("taskColumn__futerNewCard")?this.addCard(t):t.target.classList.contains("taskColumn__cardClose")&&this.dellCard(t)}onMousedown(t){document.addEventListener("mousemove",this.onMousemove);const{target:e}=t;this.shiftX=t.clientX-e.getBoundingClientRect().left,this.shiftY=t.clientY-e.getBoundingClientRect().top,this.draggedEl=e,this.draggedEl.addEventListener("dragstart",(t=>{t.preventDefault()})),e.classList.contains("taskColumn__card")&&(this.width=t.target.offsetWidth,this.height=t.target.offsetHeight,e.classList.add("taskColumn__cardDragged"),document.body.append(e),e.style.cursor="grabbing",e.style.left=t.clientX-this.shiftX+"px",e.style.top=t.clientY-this.shiftY+"px",e.style.width=`${this.width}px`,e.style.height=`${this.height}px`)}onMousemove(t){if(null===this.draggedEl||!this.draggedEl.classList.contains("taskColumn__card"))return;t.preventDefault(),this.draggedEl.style.left=t.clientX-this.shiftX+"px",this.draggedEl.style.top=t.clientY-this.shiftY+"px";const e=t.clientY-t.offsetY+this.height/2,s=t.clientX-t.offsetX+this.width/2;this.draggedEl.hidden=!0;const a=document.elementFromPoint(s,e);if(this.draggedEl.hidden=!1,a.classList.contains("taskColumn__card")){const{top:t,bottom:o}=a.getBoundingClientRect(),n=t+(o-t)/2;if(this.findShadow(a)){const{right:t}=a.closest(".taskColumn__cards").getBoundingClientRect();s>t&&this.shadowCard.remove(),e<n&&"down"===this.findShadow(a)&&(this.container.querySelector(".shadowCard").remove(),a.before(this.shadowCard)),e>n&&"up"===this.findShadow(a)&&(this.container.querySelector(".shadowCard").remove(),a.after(this.shadowCard))}else this.createShadowCard(),this.container.querySelector(".shadowCard")&&this.container.querySelector(".shadowCard").remove(),e>=n?a.after(this.shadowCard):a.before(this.shadowCard)}else!a.classList.contains("taskColumn")||a.closest(".taskColumn").querySelector(".taskColumn__card")||a.closest(".taskColumn").querySelector(".shadowCard")||(this.container.querySelector(".shadowCard")&&this.container.querySelector(".shadowCard").remove(),this.createShadowCard(),a.closest(".taskColumn").querySelector(".taskColumn__cards").append(this.shadowCard))}onMouseup(e){document.removeEventListener("mousemove",this.onMousemove),e.target.classList.remove("taskColumn__cardDragged"),this.container.querySelector(".shadowCard").replaceWith(this.draggedEl),this.draggedEl.style.left="0px",this.draggedEl.style.top="0px",this.draggedEl.style.cursor="pointer",this.draggedEl=null,t.save(this.container)}createShadowCard(){this.shadowCard=document.createElement("div"),this.shadowCard.className="shadowCard",this.shadowCard.style.width=`${this.width}px`,this.shadowCard.style.height=`${this.height}px`}findShadow(t){const e=[];e[0]=t.nextElementSibling,e[1]=t.previousElementSibling;const s=e.findIndex((t=>{if(null!==t)return t.classList.contains("shadowCard")}));return 0===s?"down":1===s?"up":null}showAddCard(t){const{target:e}=t,s=e.parentElement;if(null===s)return;e.remove();const a=document.createElement("textarea");a.setAttribute("placeholder","Ввести заголовок для этой карточки"),a.className="taskColumn__futerText",s.appendChild(a);const o=document.createElement("button");o.className="taskColumn__futerNewCard",o.textContent="Добавить карточку",s.appendChild(o);const n=document.createElement("a");n.className="taskColumn__futerClose",s.appendChild(n)}closeAddCard(t){const{target:e}=t,s=e.parentElement;null!==s&&(s.innerHTML='<a href="#" class="taskColumn__futerAdd">Добавить карточку</a>')}addCard(e){const{target:s}=e;if(null===s.parentElement)return;const a=s.closest(".taskColumn").querySelector(".taskColumn__cards"),o=s.closest(".taskColumn__futer").querySelector(".taskColumn__futerText").value,n=this.createTask(o);a.appendChild(n),this.closeAddCard(e),this.addAvents(),t.save(this.container)}showCloseTask(t){const{target:e}=t;if(e.firstChild.classList.contains("taskColumn__cardClose"))return;const s=document.createElement("div");s.className="taskColumn__cardClose",e.appendChild(s)}hideCloseTask(t){const{target:e}=t;e.querySelector(".taskColumn__cardClose").remove()}dellCard(e){const{target:s}=e;s.closest(".taskColumn__card").remove(),t.save(this.container)}createTask(t){const e=document.createElement("div");e.className="taskColumn__card";const s=document.createElement("span");return s.className="taskColumn__cardText",s.textContent=t,e.appendChild(s),e}}(".board")})();